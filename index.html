<!DOCTYPE html>
<html>

<head>
  <script data-require="d3@3.5.3" data-semver="3.5.3" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.js"></script>
  <style>
    body {
      font: 10px sans-serif;
    }
    
    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }
    
    .x.axis path {
      display: none;
    }
    
    .line {
      fill: none;
      stroke: steelblue;
      stroke-width: 1.5px;
    }
  </style>
</head>

<body>
  <script>
 
    
//d3.csv("https://rahulpatel23.github.io/nyfldata.csv",function(data){

//myData = data; 
//});
   //var myData = "date	New York	San Francisco	Austin\n\
//Latest
var actionData = "date	Action\n\
20200510	Complete Lockdown\n\
20200511	Partial Lockdown\n\
20200512	NO Opening\n";

var myData = "date	Florida	New York\n\
20200301	2	1\n\
20200302	0	0\n\
20200303	1	1\n\
20200304	0	9\n\
20200305	1	11\n\
20200306	3	22\n\
20200307	5	45\n\
20200308	1	17\n\
20200309	1	36\n\
20200310	9	31\n\
20200311	3	44\n\
20200312	20	109\n\
20200313	24	95\n\
20200314	0	189\n\
20200315	39	122\n\
20200316	32	218\n\
20200317	69	425\n\
20200318	116	1012\n\
20200319	108	1774\n\
20200320	130	2952\n\
20200321	200	3258\n\
20200322	236	4817\n\
20200323	222	5711\n\
20200324	245	4805\n\
20200325	504	7413\n\
20200326	507	5941\n\
20200327	720	5688\n\
20200328	840	8771\n\
20200329	905	6266\n\
20200330	752	7721\n\
20200331	1047	8707\n\
20200401	1027	8153\n\
20200402	1231	8996\n\
20200403	1260	10329\n\
20200404	1277	12274\n\
20200405	805	8122\n\
20200406	1279	9304\n\
20200407	1118	8314\n\
20200408	951	9568\n\
20200409	1129	10765\n\
20200410	1141	10794\n\
20200411	1018	10160\n\
20200412	877	8435\n\
20200413	1156	6548\n\
20200414	609	7402\n\
20200415	906	11755\n\
20200416	806	8631\n\
20200417	1413	7532\n\
20200418	739	7249\n\
20200419	822	6199\n\
20200420	744	4867\n\
20200421	811	4324\n\
20200422	440	5659\n\
20200423	1339	6341\n\
20200424	885	8286\n\
20200425	306	10683\n\
20200426	689	6013\n\
20200427	610	4077\n\
20200428	708	3285\n\
20200429	347	4718\n\
20200430	498	4702\n\
20200501	1037	3879\n\
20200502	735	4559\n\
20200503	615	3699\n\
20200504	819	2524\n\
20200505	542	2302\n\
20200506	563	2746\n\
20200507	826	3526\n\
20200508	371	2873\n\
20200509	802	2715\n\
20200510	595	2138\n\
20200511	386	1610\n\
20200512	941	1438\n\
20200513	479	2123\n\
20200514	808	2364\n\
20200515	928	2759\n\
20200516	673	2185\n\
20200517	777	1901\n\
20200518	854	1241\n\
20200519	502	1479\n\
20200520	527	1478\n\
20200521	1204	2078\n\
20200522	776	1678\n\
20200523	676	1754\n\
20200524	740	1601\n\
20200525	879	1279\n\
20200526	509	1044\n\
20200527	379	1132\n\
20200528	651	1758\n\
20200529	1212	1549\n\
20200530	927	1363\n\
20200531	739	1104\n\
20200601	667	945\n\
20200602	617	1361\n\
20200603	1317	1043\n\
20200604	1419	1053\n\
20200605	1305	1042\n\
20200606	1270	1083\n\
20200607	1180	777\n\
20200608	966	712\n\
20200609	1096	690\n\
20200610	1371	664\n\
20200611	1698	724\n\
20200612	1902	821\n\
20200613	2581	912\n\
20200614	2016	694\n\
20200615	1758	623\n\
20200616	2783	630\n\
20200617	2610	561\n\
20200618	3207	626\n\
20200619	3822	794\n\
20200620	4049	707\n\
20200621	3494	665\n\
20200622	2926	555\n\
20200623	3286	598\n\
20200624	5511	575\n\
20200625	5004	738\n\
20200626	8942	804\n\
20200627	9585	697\n\
20200628	8530	624\n\
20200629	5266	391\n\
20200630	6093	458\n\
20200701	6563	628\n\
20200702	10109	872\n\
20200703	9488	919\n\
20200704	11458	725\n\
20200705	10059	536\n\
20200706	6336	516\n\
20200707	7347	590\n\
20200708	9989	691\n\
20200709	8935	588\n\
20200710	11433	790\n\
20200711	10360	727\n\
20200712	15300	679\n\
20200713	12624	559\n\
20200714	9194	913\n\
20200715	10181	834\n\
20200716	13965	767\n\
20200717	11466	778\n\
20200718	10328	752\n\
20200719	12478	509\n\
20200720	10347	519\n\
20200721	9440	855\n\
20200722	9785	706\n";

    var margin = {
        top: 20,
        right: 80,
        bottom: 30,
        left: 50
      },
      width = 900 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

    var parseDate = d3.time.format("%Y%m%d").parse;

    var x = d3.time.scale()
      .range([0, width]);

    var y = d3.scale.linear()
      .range([height, 0]);

    var color = d3.scale.category10();

    var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom");

    var yAxis = d3.svg.axis()
      .scale(y)
      .orient("left");

    var line = d3.svg.line()
      .interpolate("basis")
      .x(function(d) {
        return x(d.date);
      })
      .y(function(d) {
        return y(d.cases);
      });

    var svg = d3.select("body").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var data = d3.tsv.parse(myData);
    var adata = d3.tsv.parse(actionData);
    console.log(data)
    console.log(adata);

    color.domain(d3.keys(data[0]).filter(function(key) {
      return key !== "date";
    }));

    data.forEach(function(d) {
      d.date = parseDate(d.date);
    });

    var cities = color.domain().map(function(name) {
      return {
        name: name,
        values: data.map(function(d) {
          return {
            date: d.date,
            cases: +d[name]
          };
        })
      };
    });

    x.domain(d3.extent(data, function(d) {
      return d.date;
    }));

    y.domain([
      d3.min(cities, function(c) {
        return d3.min(c.values, function(v) {
          return v.cases;
        });
      }),
      d3.max(cities, function(c) {
        return d3.max(c.values, function(v) {
          return v.cases;
        });
      })
    ]);

  

    var legend = svg.selectAll('g')
      .data(cities)
      .enter()
      .append('g')
      .attr('class', 'legend');

    legend.append('rect')
      .attr('x', width - 20)
      .attr('y', function(d, i) {
        return i * 20;
      })
      .attr('width', 10)
      .attr('height', 10)
      .style('fill', function(d) {
        return color(d.name);
      });

    legend.append('text')
      .attr('x', width - 8)
      .attr('y', function(d, i) {
        return (i * 20) + 9;
      })
      .text(function(d) {
        return d.name;
      });
    //console.log(function(adata){return adata.date});
    //console.log(function(adata){return x(adata.date)});
    svg.append("g").attr("class","ActionTimeLine").selectAll("TimeLineCircle").data(adata).enter().append("circle").attr("r", 7)
      .attr("cx",function(d){return x(d.date)})
      .attr("cy","60")
      .attr("class","TimeLineCircle")
      .style("stroke", "purple").style("fill", "purple")
      .style("stroke-width", "2px")
      .style("opacity", "1");



    svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

    svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Cases");

    var city = svg.selectAll(".city")
      .data(cities)
      .enter().append("g")
      .attr("class", "city");

    city.append("path")
      .attr("class", "line")
      .attr("d", function(d) {
        return line(d.values);
      })
      .style("stroke", function(d) {
        return color(d.name);
      });

    city.append("text")
      .datum(function(d) {
        return {
          name: d.name,
          value: d.values[d.values.length - 1]
        };
      })
      .attr("transform", function(d) {
        return "translate(" + x(d.value.date) + "," + y(d.value.cases) + ")";
      })
      .attr("x", 3)
      .attr("dy", ".35em")
      .text(function(d) {
        return d.name;
      });

    var mouseG = svg.append("g")
      .attr("class", "mouse-over-effects");

    mouseG.append("path") // this is the black vertical line to follow mouse
      .attr("class", "mouse-line")
      .style("stroke", "black")
      .style("stroke-width", "1px")
      .style("opacity", "0");
      
    var lines = document.getElementsByClassName('line');

    var mousePerLine = mouseG.selectAll('.mouse-per-line')
      .data(cities)
      .enter()
      .append("g")
      .attr("class", "mouse-per-line");

    mousePerLine.append("circle")
      .attr("r", 7)
      .style("stroke", function(d) {
        return color(d.name);
      })
      .style("fill", "none")
      .style("stroke-width", "1px")
      .style("opacity", "0");

    mousePerLine.append("text")
      .attr("transform", "translate(10,3)");

    mouseG.append('svg:rect') // append a rect to catch mouse movements on canvas
      .attr('width', width) // can't catch mouse events on a g element
      .attr('height', height)
      .attr('fill', 'none')
      .attr('pointer-events', 'all')
      .on('mouseout', function() { // on mouse out hide line, circles and text
        d3.select(".mouse-line")
          .style("opacity", "0");
        d3.selectAll(".mouse-per-line circle")
          .style("opacity", "0");
        d3.selectAll(".mouse-per-line text")
          .style("opacity", "0");
      })
      .on('mouseover', function() { // on mouse in show line, circles and text
        d3.select(".mouse-line")
          .style("opacity", "1");
        d3.selectAll(".mouse-per-line circle")
          .style("opacity", "1");
        d3.selectAll(".mouse-per-line text")
          .style("opacity", "1");
      })
      .on('mousemove', function() { // mouse moving over canvas
        var mouse = d3.mouse(this);
        d3.select(".mouse-line")
          .attr("d", function() {
            var d = "M" + mouse[0] + "," + height;
            d += " " + mouse[0] + "," + 0;
            return d;
          });

        d3.selectAll(".mouse-per-line")
          .attr("transform", function(d, i) {
            console.log(width/mouse[0])
            var xDate = x.invert(mouse[0]),
                bisect = d3.bisector(function(d) { return d.date; }).right;
                idx = bisect(d.values, xDate);
            
            var beginning = 0,
                end = lines[i].getTotalLength(),
                target = null;

            while (true){
              target = Math.floor((beginning + end) / 2);
              pos = lines[i].getPointAtLength(target);
              if ((target === end || target === beginning) && pos.x !== mouse[0]) {
                  break;
              }
              if (pos.x > mouse[0])      end = target;
              else if (pos.x < mouse[0]) beginning = target;
              else break; //position found
            }
            
            d3.select(this).select('text')
              //.text(y.invert(pos.y).toFixed(2));
              //.text("(" + y.invert(pos.y).toFixed(0) + "," + d3.time.format("%Y%m%d").parse(x.invert(pos.x)) + ")")
              .text("(" + y.invert(pos.y).toFixed(0) + ", dt)")
            return "translate(" + mouse[0] + "," + pos.y +")";
          });
      });
      
  </script>
</body>

</html>
